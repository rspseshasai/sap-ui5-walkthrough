/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/Element","sap/ui/model/Sorter","sap/ui/Device","sap/ui/thirdparty/jquery"],function(e,t,o,jQuery){"use strict";const n=new window.WeakMap;const r={TableUtils:null,HierarchyMode:{Flat:"Flat",Group:"Group",Tree:"Tree",GroupedTree:"GroupedTree"},setHierarchyMode:function(e,t){if(!r.TableUtils.isA(e,"sap.ui.table.Table")||!(t in r.HierarchyMode)){return}const o=r.getHierarchyMode(e);if(o!==t){n.set(e,t);e.invalidate()}},getHierarchyMode:function(e){return r.TableUtils.isA(e,"sap.ui.table.Table")?n.get(e)||r.HierarchyMode.Flat:null},setToDefaultFlatMode:function(e){r.setHierarchyMode(e,r.HierarchyMode.Flat)},setToDefaultGroupMode:function(e){r.setHierarchyMode(e,r.HierarchyMode.Group)},setToDefaultTreeMode:function(e){r.setHierarchyMode(e,r.HierarchyMode.Tree)},isInFlatMode:function(e){return r.getHierarchyMode(e)===r.HierarchyMode.Flat},isInGroupMode:function(e){const t=r.getHierarchyMode(e);return t===r.HierarchyMode.Group||t===r.HierarchyMode.GroupedTree},isInTreeMode:function(e){return r.getHierarchyMode(e)===r.HierarchyMode.Tree},getModeCssClass:function(e){switch(r.getHierarchyMode(e)){case r.HierarchyMode.Group:case r.HierarchyMode.GroupedTree:return"sapUiTableGroupMode";case r.HierarchyMode.Tree:return"sapUiTableTreeMode";default:return null}},isInGroupHeaderRow:function(e){const t=r.TableUtils.getCellInfo(e);if(t.isOfType(r.TableUtils.CELLTYPE.ANYCONTENTCELL)){return t.cell.parentElement.classList.contains("sapUiTableGroupHeaderRow")}return false},isInSummaryRow:function(e){const t=r.TableUtils.getCellInfo(e);if(t.isOfType(r.TableUtils.CELLTYPE.ANYCONTENTCELL)){return t.cell.parentElement.classList.contains("sapUiTableSummaryRow")}return false},calcGroupIndent:function(e){const t=r.getHierarchyMode(e.getTable())===r.HierarchyMode.GroupedTree;const o=!t&&!e.isGroupHeader()&&!e.isTotalSummary();const n=e.getLevel()-(o?1:0);let a=0;for(let e=1;e<n;e++){if(e===1){a=24}else if(e===2){a+=12}else{a+=8}}return a},calcTreeIndent:function(e){return(e.getLevel()-1)*17},setGroupIndent:function(e,t){const o=e.getDomRefs(true);const n=o.row;const r=o.rowHeaderPart;const a=e.getTable()._bRtlMode;const i=n.find("td.sapUiTableCellFirst > .sapUiTableCellInner");const s=r.find(".sapUiTableGroupShield");if(t<=0){r.css(a?"right":"left","");s.css("width","").css(a?"margin-right":"margin-left","");i.css(a?"padding-right":"padding-left","");n.css("--CalculatedGroupIndent","0")}else{r.css(a?"right":"left",t+"px");s.css("width",t+"px").css(a?"margin-right":"margin-left",-1*t+"px");i.css(a?"padding-right":"padding-left",t+8+"px");n.css("--CalculatedGroupIndent",t+"px")}},setTreeIndent:function(e,t){const o=e.getDomRefs(true);const n=o.row;const r=e.getTable()._bRtlMode;const a=n.find(".sapUiTableTreeIcon");a.css(r?"margin-right":"margin-left",t>0?t+"px":"")},updateTableRowForGrouping:function(e){const t=e.getTable();const o=e.getDomRefs(true);const n=o.row;const a=e.isExpanded();const i=e.isExpandable();n.toggleClass("sapUiTableSummaryRow",e.isSummary());if(r.isInGroupMode(t)){const t=e.getTitle();const o=r.calcGroupIndent(e);e.$("groupHeader").toggleClass("sapUiTableGroupIconOpen",i&&a).toggleClass("sapUiTableGroupIconClosed",i&&!a).text(t);r.setGroupIndent(e,o);n.toggleClass("sapUiTableRowIndented",o>0).toggleClass("sapUiTableGroupHeaderRow",e.isGroupHeader())}if(r.isInTreeMode(t)){const o=n.find(".sapUiTableTreeIcon");if(!i&&document.activeElement===o[0]){r.TableUtils.getParentCell(t,o[0]).trigger("focus")}o.toggleClass("sapUiTableTreeIconLeaf",!i).toggleClass("sapUiTableTreeIconNodeOpen",i&&a).toggleClass("sapUiTableTreeIconNodeClosed",i&&!a);r.setTreeIndent(e,r.calcTreeIndent(e))}if(!r.isInFlatMode(t)){t._getAccExtension().updateAriaExpandAndLevelState(e)}},cleanupTableRowForGrouping:function(e){const t=e.getTable();const o=e.getDomRefs(true);if(r.isInGroupMode(t)){o.row.removeClass("sapUiTableGroupHeaderRow sapUiTableSummaryRow sapUiTableRowIndented");e.$("groupHeader").removeClass("sapUiTableGroupIconOpen","sapUiTableGroupIconClosed").attr("title","").text("");r.setGroupIndent(e,0)}if(r.isInTreeMode(t)){o.row.find(".sapUiTableTreeIcon").removeClass("sapUiTableTreeIconLeaf").removeClass("sapUiTableTreeIconNodeOpen").removeClass("sapUiTableTreeIconNodeClosed");r.setTreeIndent(e,0)}t._getAccExtension().updateAriaExpandAndLevelState(e)},updateGroups:function(e){if(e.getBinding()){e.getRows().forEach(function(e){r.updateTableRowForGrouping(e)})}else{e.getRows().forEach(function(e){r.cleanupTableRowForGrouping(e)})}},setupExperimentalGrouping:function(o){if(!o.getEnableGrouping()){return}const n=o.getBinding();const a=e.getElementById(o.getGroupBy());const i=a&&a.getGrouped()&&r.TableUtils.isA(n,"sap.ui.model.ClientListBinding");if(!i||n._modified){return}n._modified=true;r.setToDefaultGroupMode(o);const s=a.getSortProperty();n.sort(new t(s));const l=o._getTotalRowCount();const p=n.getContexts(0,l);let u;let d=0;for(let e=l-1;e>=0;e--){const t=p[e].getProperty(s);if(!u){u=t}if(u!==t){const o=p[e+1].getModel().getContext("/sap.ui.table.GroupInfo"+e);o.__groupInfo={oContext:p[e+1],name:u,count:d,groupHeader:true,expanded:true};p.splice(e+1,0,o);u=t;d=0}d++}const c=p[0].getModel().getContext("/sap.ui.table.GroupInfo");c.__groupInfo={oContext:p[0],name:u,count:d,groupHeader:true,expanded:true};p.splice(0,0,c);jQuery.extend(n,{getLength:function(){return p.length},getContexts:function(e,t){return p.slice(e,e+t)}});function g(e){const t=p[e];return(t&&t.__groupInfo&&t.__groupInfo.groupHeader)===true}o._experimentalGroupingRowState=function(e){const t=e.context;if((t&&t.__groupInfo&&t.__groupInfo.groupHeader)===true){e.type=e.Type.GroupHeader}e.title=t&&t.__groupInfo&&t.__groupInfo.name+" - "+t.__groupInfo.count;e.expandable=e.type===e.Type.GroupHeader;e.expanded=e.expandable&&t.__groupInfo&&t.__groupInfo.expanded;e.level=e.expandable?1:2;e.contentHidden=e.expandable};o._experimentalGroupingExpand=function(e){const t=e.getIndex();if(g(t)&&!p[t].__groupInfo.expanded){for(let e=0;e<p[t].__childs.length;e++){p.splice(t+1+e,0,p[t].__childs[e])}delete p[t].__childs;p[t].__groupInfo.expanded=true;n._fireChange()}};o._experimentalGroupingCollapse=function(e){const t=e.getIndex();if(g(t)&&p[t].__groupInfo.expanded){p[t].__childs=p.splice(t+1,p[t].__groupInfo.count);p[t].__groupInfo.expanded=false;n._fireChange()}};const f=r.TableUtils.Hook;f.register(o,f.Keys.Row.UpdateState,o._experimentalGroupingRowState);f.register(o,f.Keys.Row.Expand,o._experimentalGroupingExpand);f.register(o,f.Keys.Row.Collapse,o._experimentalGroupingCollapse);o._mTimeouts.groupingFireBindingChange=o._mTimeouts.groupingFireBindingChange||window.setTimeout(function(){n._fireChange()},0)},resetExperimentalGrouping:function(e){const t=e.getBinding();const o=r.TableUtils.Hook;if(t&&t._modified){r.setToDefaultFlatMode(e);e.bindRows(e.getBindingInfo("rows"))}o.deregister(e,o.Keys.Row.UpdateState,e._experimentalGroupingRowState);o.deregister(e,o.Keys.Row.Expand,e._experimentalGroupingExpand);o.deregister(e,o.Keys.Row.Collapse,e._experimentalGroupingCollapse);delete e._experimentalGroupingRowState;delete e._experimentalGroupingExpand;delete e._experimentalGroupingCollapse}};return r},true);
//# sourceMappingURL=_GroupingUtils.js.map