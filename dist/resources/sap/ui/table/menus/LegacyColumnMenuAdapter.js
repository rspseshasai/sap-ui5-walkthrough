/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ColumnHeaderMenuAdapter","sap/ui/table/ColumnMenu","sap/ui/table/AnalyticalColumnMenu","sap/ui/table/utils/TableUtils","sap/ui/core/Popup","sap/ui/Device","sap/ui/base/ManagedObjectObserver"],function(e,t,n,o,l,s,u){"use strict";const i=["sortProperty","filterProperty","showSortMenuEntry","showFilterMenuEntry"];const a=["filterValue"];const r=["enableCustomFilter","enableGrouping","enableColumnFreeze","showColumnVisibilityMenu"];const c=e.extend("sap.ui.table.menus.LegacyColumnMenuAdapter",{constructor:function(){e.apply(this,arguments);this._oLegacyMenuObserver=new u(function(e){if(e.old!==e.current){if(i.indexOf(e.name)>-1){this._invalidateMenu(e.object)}else if(a.indexOf(e.name)>-1){this._setFilterValue(e.object,e.current)}else if(r.indexOf(e.name)>-1){this._invalidateAllMenus()}}}.bind(this))}});c.prototype.injectMenuItems=function(e,t){const n=t._getTable();const o=t.getDomRef();const l=o.querySelector(".sapUiTableColDropDown")!==null;if(!s.system.desktop&&!l){return this._applyColumnHeaderCellMenu(t)}this._removeColumnHeaderCellMenu(n);const u=n.fireColumnSelect({column:t});if(u){this._openColumnContextMenu(t)}};c.prototype._invalidateMenu=function(e){const t=e.getMenu();if(o.isA(t,"sap.ui.table.ColumnMenu")){t._invalidate()}};c.prototype._invalidateAllMenus=function(e){const t=e.getColumns();for(let e=0,n=t.length;e<n;e++){this._invalidateMenu(t[e])}};c.prototype._setFilterValue=function(e,t){const n=e.getMenu();if(o.isA(n,"sap.ui.table.ColumnMenu")){n._setFilterValue(t)}};c.prototype._setFilterState=function(e,t){const n=e.getMenu();if(o.isA(n,"sap.ui.table.ColumnMenu")){n._setFilterState(t)}};c.prototype._applyColumnHeaderCellMenu=function(e){const t=e._getTable();const n=e.getDomRef();const o=n.getAttribute("colspan");const l=n.querySelector(".sapUiTableCellInner");const s=n.querySelector(".sapUiTableCellTouchMenu")!==null;if(o&&o!=="1"||s||!e.getResizable()&&!e._menuHasItems()){return false}const u=document.createElement("div");this._removeColumnHeaderCellMenu(t);l.style.display="none";if(e._menuHasItems()){const e=document.createElement("div");e.classList.add("sapUiTableColDropDown");e.textContent="";u.appendChild(e)}if(e.getResizable()){const e=document.createElement("div");e.classList.add("sapUiTableColResizer");e.textContent="";u.appendChild(e)}u.classList.add("sapUiTableCellTouchMenu");n.appendChild(u);const i=function(){this._removeColumnHeaderCellMenu(t);n.removeEventListener("focusout",i)}.bind(this);n.addEventListener("focusout",i);return true};c.prototype._removeColumnHeaderCellMenu=function(e){const t=e&&e.$().find(".sapUiTableCHT .sapUiTableCellTouchMenu");if(t.length){t.parent().find(".sapUiTableCellInner").show();t.remove()}};c.prototype._openColumnContextMenu=function(e){const t=e._getTable();const n=e._cellPressed;const o=t.getColumns();for(let t=0;t<o.length;t++){if(o[t]!==e){this._closeColumnContextMenu(o[t])}}const l=n.getAttribute("colspan");if(l&&l!=="1"){return false}return this._openMenu(e,n)};c.prototype._openMenu=function(e,t){const n=this._getMenu(e);if(!e._menuHasItems()){return false}const o=e.fireColumnMenuOpen({menu:n});if(o){const e=l.Dock;n.open(null,t,e.BeginTop,e.BeginBottom,t);return true}else{return true}};c.prototype._closeColumnContextMenu=function(e){const t=e.getMenu();if(t){t.close()}};c.prototype._getMenu=function(e){let t=e.getMenu();if(!t){t=this._createMenu(e);e.setAggregation("menu",t,true);const n=i.concat(a).concat(r);this._oLegacyMenuObserver.observe(e,{properties:n});o.Hook.register(e._getTable(),o.Hook.Keys.Column.SetFilterState,this._setFilterState,this)}return t};c.prototype._createMenu=function(e){const o=e.isA("sap.ui.table.AnalyticalColumn")?n:t;return new o(e.getId()+"-menu",{ariaLabelledBy:e})};return c});
//# sourceMappingURL=LegacyColumnMenuAdapter.js.map