/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../utils/TableUtils","sap/ui/base/Object","sap/ui/base/EventProvider","sap/ui/base/ManagedObjectObserver"],function(e,t,n,o){"use strict";const i=new window.Map;const r={default:"LegacyColumnMenuAdapter","sap.m.table.columnmenu.Menu":"MobileColumnHeaderMenuAdapter","sap.ui.table.test.Menu":"test/TestAdapter"};const s=t.extend("sap.ui.table.menus.ColumnHeaderMenuAdapter",{constructor:function(){t.apply(this,arguments);this._mInjectionTarget=null;this._oColumnHeaderMenuObserver=new o(function(e){this.onAfterMenuDestroyed(e.object)}.bind(this))}});s.activateFor=function(t){const n=t.getHeaderMenuInstance();const o=a(n);let r;if(!o||!t._getTable()){return Promise.resolve()}i.forEach(function(e,n){if(n!==o){c(t,n)}});if(!i.has(o)){r={adapter:u(o).then(function(n){r=i.get(o);r.adapter=new n;r.adapter._injectMenuItems(r.activeFor.getHeaderMenuInstance(),r.activeFor);if(o==="LegacyColumnMenuAdapter"){e.Hook.register(t._getTable(),e.Hook.Keys.Table.InvalidateColumnMenus,r.adapter._invalidateAllMenus,r.adapter)}}),columns:[t],activeFor:t};i.set(o,r)}else{r=i.get(o);r.activeFor=t;if(!r.columns.includes(t)){r.columns.push(t)}}if(r.adapter instanceof Promise){return r.adapter}r.adapter._injectMenuItems(n,t);return Promise.resolve()};s.unlink=function(e){c(e)};s.prototype._injectMenuItems=function(e,t){this._removeMenuItems();this._oColumnHeaderMenuObserver.observe(e,{destroy:true});this.injectMenuItems(e,t);this._mInjectionTarget={column:t,menu:e}};s.prototype._removeMenuItems=function(){if(!this._mInjectionTarget){return}this.removeMenuItems(this._mInjectionTarget.menu);this._mInjectionTarget=null};s.prototype.injectMenuItems=function(e,t){};s.prototype.removeMenuItems=function(e){};s.prototype.onAfterMenuDestroyed=function(e){};s.prototype.destroy=function(){t.prototype.destroy.apply(this,arguments);this._removeMenuItems();this._oColumnHeaderMenuObserver.disconnect();delete this._oColumnHeaderMenuObserver};function u(e){return new Promise(function(t,n){sap.ui.require(["sap/ui/table/menus/"+e],function(e){t(e)},function(e){n(e)})})}function a(t){for(const n in r){if(e.isA(t,n)){return r[n]}}return r.default}function c(e,t){let n;if(t){n=i.get(t)}else{i.forEach(function(o,i){if(o.columns.includes(e)){n=o;t=i}})}if(!n){return}if(n.adapter instanceof Promise){n.adapter.then(function(){c(e,t)})}else{if(n.columns.includes(e)){n.columns.splice(n.columns.indexOf(e),1)}if(n.columns.length===0){n.adapter.destroy();i.delete(t)}}}return s});
//# sourceMappingURL=ColumnHeaderMenuAdapter.js.map