/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["../utils/TableUtils","../library","sap/base/i18n/Localization","sap/ui/base/Object","sap/ui/Device","sap/ui/events/KeyCodes","sap/ui/thirdparty/jquery"],function(e,t,n,o,i,s,jQuery){"use strict";const l=e.CELLTYPE;const r=t.SelectionMode;const f={CTRL:1,SHIFT:2,ALT:4};const c=5;const a="1rem";function u(e,t){e.setMarked("sapUiTableSkipItemNavigation",t!==false)}function g(t){if(e.getCellInfo(t.target).isOfType(l.ANY)){t.preventDefault();t.stopPropagation()}}const d=o.extend("sap.ui.table.extensions.KeyboardDelegate",{constructor:function(e){o.call(this)},destroy:function(){o.prototype.destroy.apply(this,arguments)},getInterface:function(){return this}});function h(t,n){if(!E(t,n)){return}const o=e.getCellInfo(e.getCell(t,n.target));if(o.isOfType(l.ANYCOLUMNHEADER)){C(t,o,n)}else if(o.isOfType(l.ANYCONTENTCELL)){p(t,o,n)}}function C(t,n,o){const i=e.getHeaderRowCount(t);if(e.isNoDataVisible(t)){const n=e.getFocusedItemInfo(t);if(n.row-i<=1){u(o)}}else if(n.isOfType(l.COLUMNROWHEADER)&&i>1){u(o);e.focusItem(t,i*(e.getVisibleColumnCount(t)+1),o)}}function p(t,n,o){const i=t._getKeyboardExtension();const s=i.isInActionMode();const l=d._isKeyCombination(o,null,f.CTRL);const r=l||s;const c=e.getParentCell(t,o.target);if(!r&&c){c.trigger("focus");return}u(o);if(e.isLastScrollableRow(t,n.cell)){const e=R(t,o);if(e){o.preventDefault();return}}if(n.rowIndex===t.getRows().length-1||e.isVariableRowHeightEnabled(t)&&n.rowIndex===t.getRows().length-2&&t.getRows()[n.rowIndex+1].getRowBindingContext()===null){if(!s&&c){c.trigger("focus")}else{const e=t.getCreationRow();if(!e||!e._takeOverKeyboardHandling(o)){i.setActionMode(false)}}return}v(t,n.type,n.rowIndex+1,n.columnIndex,r);o.preventDefault()}function m(t,n){const o=e.getCellInfo(e.getCell(t,n.target));if(!o.isOfType(l.ANYCONTENTCELL)||!E(t,n)){return}const i=d._isKeyCombination(n,null,f.CTRL);const s=t._getKeyboardExtension();const r=s.isInActionMode();const c=i||r;const a=e.getParentCell(t,n.target);if(!c&&a){a.trigger("focus");return}u(n);if(e.isFirstScrollableRow(t,o.cell)){const e=y(t,n);if(e){n.preventDefault();return}}if(o.rowIndex===0){u(n,c);if(!r&&a){a.trigger("focus")}else{s.setActionMode(false)}return}v(t,o.type,o.rowIndex-1,o.columnIndex,c);n.preventDefault()}function E(e,t){const n=d._isKeyCombination(t,null,f.CTRL);return!t.isMarked()&&(n||!(t.target instanceof window.HTMLInputElement)&&!(t.target instanceof window.HTMLTextAreaElement))}function I(e){return new Promise(function(t){e.attachEventOnce("_rowsUpdated",t)})}function T(e){if(e._isWaitingForData()){return I(e).then(function(){return T(e)})}return Promise.resolve()}function R(e,t,n,o){const i=e._getFirstRenderedRowIndex()===e._getMaxFirstRenderedRowIndex();if(i){return null}return A(e,t,true,n,o)}function y(e,t,n,o){const i=e._getFirstRenderedRowIndex()===0;if(i){return null}return A(e,t,false,n,o)}function A(t,n,o,i,s){const r=e.getCellInfo(e.getCell(t,n.target));const c=t._getKeyboardExtension().isInActionMode();const a=d._isKeyCombination(n,null,f.CTRL);const u=a||c;const g=c&&r.isOfType(l.DATACELL);if(g){t._getKeyboardExtension().setSilentFocus(t.getDomRef("focusDummy"));setTimeout(function(){t._getScrollExtension().scrollVertically(o===true,i)},0)}else{t._getScrollExtension().scrollVertically(o===true,i)}return I(t).then(function(){if(s){s()}else if(u){v(t,r.type,r.rowIndex,r.columnIndex,true)}})}function x(e,t){const n=e._getRowCounts();const o=R(e,t,false,function(){O(e,n.fixedTop+n.scrollable-1)});if(o){return}if(n.fixedBottom>0){O(e,n.fixedTop+n.scrollable)}else{e._getKeyboardExtension().setActionMode(false)}}function O(t,n){const o=t.getRows()[n];const i=o.isGroupHeader()||e.isRowSelectorSelectionAllowed(t);if(i){v(t,l.ROWHEADER,n)}else{const e=d._getFirstInteractiveElement(o);if(e){d._focusElement(t,e[0])}else{v(t,l.DATACELL,n,0,false,true);if(o.getIndex()===t._getTotalRowCount()-1){t._getKeyboardExtension().setActionMode(false)}}}}function _(e,t){const n=e._getRowCounts();const o=y(e,t,false,function(){b(e,n.fixedTop)});if(o){return}if(n.fixedTop>0){b(e,n.fixedTop-1)}else{e._getKeyboardExtension().setActionMode(false)}}function b(t,n){const o=t.getRows()[n];const i=o.isGroupHeader()||e.isRowSelectorSelectionAllowed(t);const s=d._getLastInteractiveElement(o);if(s){d._focusElement(t,s[0])}else if(i){v(t,l.ROWHEADER,n)}else{v(t,l.DATACELL,n,0,false,true);if(o.getIndex()===0){t._getKeyboardExtension().setActionMode(false)}}}function w(t,n){const o=e.getFocusedItemInfo(t);const i=t._getKeyboardExtension().getLastFocusedCellInfo();e.focusItem(t,o.cellInRow+o.columnCount*i.row,n)}function L(t,n){const o=e.getFocusedItemInfo(t);e.focusItem(t,o.cellInRow,n)}function S(e,t){e._getKeyboardExtension().setSilentFocus(e.$().find("."+t))}d._isKeyCombination=function(e,t,n){if(n==null){n=0}const o=typeof t==="string"?String.fromCharCode(e.charCode):e.keyCode;let l=0;l|=(i.os.macintosh?e.metaKey:e.ctrlKey)&&t!==s.CONTROL?f.CTRL:0;l|=e.shiftKey&&t!==s.SHIFT?f.SHIFT:0;l|=e.altKey&&t!==s.ALT?f.ALT:0;const r=t==null||o===t;const c=n===l;return r&&c};function N(t,n){const o=e.getCell(t,n);const i=e.getCellInfo(o);return t.getRows()[i.rowIndex]}function D(t,n){const o=e.getCellInfo(n.target);if(o.isOfType(l.COLUMNROWHEADER)){t._getSelectionPlugin().onHeaderSelectorPress()}else if(d._allowsToggleExpandedState(t,n.target)){N(t,n.target).toggleExpandedState()}else if(o.isOfType(l.ROWHEADER)){i()}else if(o.isOfType(l.DATACELL|l.ROWACTION)){let o=!t.hasListeners("cellClick");if(!t._findAndfireCellEvent(t.fireCellClick,n)){if(e.isRowSelectionAllowed(t)){i();o=false}}if(o){const o=e.getInteractiveElements(n.target);if(o){t._getKeyboardExtension().setActionMode(true)}}}function i(){let o=null;if(t._legacyMultiSelection){o=function(e){t._legacyMultiSelection(e.getIndex(),n)}}e.toggleRowSelection(t,n.target,null,o)}}function M(t,n){const o=t.getParent();const i=o._getVisibleColumns();const s=i.indexOf(t);let l;if(n&&s<i.length-1){l=o.indexOfColumn(i[s+1])+1}else if(!n&&s>0){l=o.indexOfColumn(i[s-1])}if(l!=null){e.Column.moveColumnTo(t,l)}}function K(e,t){const n=e.getColumns().filter(function(e){return e.getVisible()||(e.getGrouped?e.getGrouped():false)});for(let e=0;e<n.length;e++){const o=n[e];if(o===t){return e}}return-1}function H(t,n,o){if(!o){if(t._oRangeSelection.selected){e.toggleRowSelection(t,n,true)}else{e.toggleRowSelection(t,n,false)}}else{e.toggleRowSelection(t,n,false)}}d._focusElement=function(e,t,n){if(!e||!t){return}if(n==null){n=false}if(n){e._getKeyboardExtension().setSilentFocus(t)}else{t.focus()}if(t instanceof window.HTMLInputElement){t.select()}};function v(t,n,o,i,s,r){if(!t||n==null||o==null||o<0||o>=t.getRows().length){return}const f=t.getRows()[o];let c;if(n===l.ROWHEADER){t._getKeyboardExtension().setFocus(t.getDomRef("rowsel"+o));return}else if(n===l.ROWACTION){c=t.getDomRef("rowact"+o)}else if(n===l.DATACELL&&(i!=null&&i>=0)){const e=t.getColumns()[i];const n=K(t,e);if(n>=0){c=f.getDomRef("col"+n)}}if(!c){return}if(s){const n=e.getInteractiveElements(c);if(n){d._focusElement(t,n[0]);return}}if(r){t._getKeyboardExtension()._bStayInActionMode=true}c.focus()}function F(e){return e.classList.contains("sapUiTableTreeIconNodeOpen")||e.classList.contains("sapUiTableTreeIconNodeClosed")}d._allowsToggleExpandedState=function(t,n){return e.Grouping.isInGroupHeaderRow(n)||e.Grouping.isInTreeMode(t)&&n.classList.contains("sapUiTableCellFirst")&&(n.querySelector(".sapUiTableTreeIconNodeOpen")||n.querySelector(".sapUiTableTreeIconNodeClosed"))||F(n)};d._isElementInteractive=function(t){if(!t){return false}return jQuery(t).is(e.INTERACTIVE_ELEMENT_SELECTORS)};d._getFirstInteractiveElement=function(t){const n=e.getFirstInteractiveElement(t,true);if(!n){return null}return jQuery(n)};d._getLastInteractiveElement=function(t){if(!t){return null}const n=t.getParent();const o=t.getCells();let i;let s;if(e.hasRowActions(n)){o.push(t.getRowAction())}for(let t=o.length-1;t>=0;t--){i=e.getParentCell(n,o[t].getDomRef());s=e.getInteractiveElements(i);if(s){return s.last()}}return null};d._getPreviousInteractiveElement=function(t,n){if(!t||!n){return null}const o=jQuery(n);if(!this._isElementInteractive(o)){return null}let i=e.getParentCell(t,n);let s;let r;let f;let c;let a;s=e.getInteractiveElements(i);if(s[0]!==o[0]){return s.eq(s.index(n)-1)}const u=e.getCellInfo(i);const g=t.getRows()[u.rowIndex].getCells();if(u.isOfType(l.ROWACTION)){a=g.length-1}else{f=t.getColumns()[u.columnIndex];c=K(t,f);a=c-1}for(let n=a;n>=0;n--){r=g[n].getDomRef();i=e.getParentCell(t,r);s=e.getInteractiveElements(i);if(s){return s.last()}}return null};d._getNextInteractiveElement=function(t,n){if(!t||!n){return null}const o=jQuery(n);if(!this._isElementInteractive(o)){return null}let i=e.getParentCell(t,n);let s;let r;s=e.getInteractiveElements(i);if(s.get(-1)!==o[0]){return s.eq(s.index(n)+1)}const f=e.getCellInfo(i);if(f.isOfType(l.ROWACTION)){return null}const c=t.getRows()[f.rowIndex];const a=c.getCells();const u=t.getColumns()[f.columnIndex];const g=K(t,u);for(let n=g+1;n<a.length;n++){r=a[n].getDomRef();i=e.getParentCell(t,r);s=e.getInteractiveElements(i);if(s){return s.first()}}if(e.hasRowActions(t)){i=e.getParentCell(t,c.getRowAction().getDomRef());s=e.getInteractiveElements(i);if(s.get(-1)!==o[0]){return s.eq(s.index(n)+1)}}return null};function U(t){const n=e.getRowIndexOfFocusedCell(t);const o=t.getRows()[n];const i=o.getIndex();t._oRangeSelection={startIndex:i,selected:o._isSelected()}}d.prototype.enterActionMode=function(){const t=this._getKeyboardExtension();const n=document.activeElement;const o=e.getInteractiveElements(n);const i=e.getParentCell(this,n);const s=e.getCellInfo(i);if(s.isOfType(l.ANYCOLUMNHEADER)){return false}if(o){t.suspendItemNavigation();n.tabIndex=-1;d._focusElement(this,o[0],true);return true}else if(i){this._getKeyboardExtension().suspendItemNavigation();return true}return false};d.prototype.leaveActionMode=function(t){const n=this._getKeyboardExtension();const o=document.activeElement;const i=e.getParentCell(this,o);n.resumeItemNavigation();if(t){return}if(i){d._focusElement(this,i[0],true)}else{const e=this._getItemNavigation();if(e){const t=e.aItemDomRefs;const n=t.indexOf(o);if(n>-1){e.setFocusedIndex(n)}}n.setSilentFocus(o)}};d.prototype.onfocusout=function(e){if(this.getRows().length||this.getColumnHeaderVisible()){this.$().find(".sapUiTableCtrlBefore").attr("tabindex","0");this.$().find(".sapUiTableCtrlAfter").attr("tabindex","0")}};d.prototype.onfocusin=function(t){if(this.getDomRef("sapUiTableCnt").contains(t.target)){this.$().find(".sapUiTableCtrlBefore").attr("tabindex","-1");this.$().find(".sapUiTableCtrlAfter").attr("tabindex","-1")}if(t.isMarked("sapUiTableIgnoreFocusIn")){return}const n=jQuery(t.target);if(n.hasClass("sapUiTableOuterBefore")||n.hasClass("sapUiTableOuterAfter")||t.target!==this.getDomRef("overlay")&&this.getShowOverlay()){this.$("overlay").trigger("focus")}else if(n.hasClass("sapUiTableCtrlBefore")){const n=e.isNoDataVisible(this);const o=this.getDomRef("busyIndicator");if(o){this._getKeyboardExtension().setSilentFocus(o)}else if(this.getColumnHeaderVisible()&&(e.getVisibleColumnCount(this)||e.hasRowHeader(this))){L(this,t)}else if(n){this._getKeyboardExtension().setSilentFocus(this.$("noDataCnt"))}}else if(n.hasClass("sapUiTableCtrlAfter")){const n=this.getDomRef("busyIndicator");if(n){this._getKeyboardExtension().setSilentFocus(n)}else if(this.getRows().length&&!e.isNoDataVisible(this)){w(this,t)}else if(this.getColumnHeaderVisible()&&(e.getVisibleColumnCount(this)||e.hasRowHeader(this))){L(this,t)}}const o=e.getCellInfo(t.target);const i=o.isOfType(l.ROWHEADER)&&e.Grouping.isInGroupHeaderRow(t.target);const s=o.isOfType(l.ROWHEADER)&&!i&&e.isRowSelectorSelectionAllowed(this);const r=o.isOfType(l.DATACELL)&&this._getKeyboardExtension()._bStayInActionMode;const f=e.getCellInfo(e.getParentCell(this,t.target)).isOfType(l.ANYCONTENTCELL);const c=d._isElementInteractive(t.target);const a=this._getKeyboardExtension().isInActionMode();const u=a&&(i||s||r)||c&&f;if(r){this._getKeyboardExtension()._bStayInActionMode=false}this._getKeyboardExtension().setActionMode(u,true)};d.prototype.onkeydown=function(t){if(t.isMarked()){return}const n=this._getKeyboardExtension();let o=e.getCellInfo(t.target);const i=this.getSelectionMode();const c=this._getSelectionPlugin();if(d._isKeyCombination(t,s.F2)){const i=n.isInActionMode();const s=e.getCell(this,t.target);const r=e.getParentCell(this,t.target)!=null;o=e.getCellInfo(s);if(!i&&r){s.trigger("focus")}else if(o.isOfType(l.ANYCOLUMNHEADER)){const t=e.getInteractiveElements(s);if(t){t[0].focus()}}else{n.setActionMode(!i)}return}if(d._isKeyCombination(t,s.F4)&&d._allowsToggleExpandedState(this,t.target)){N(this,t.target).toggleExpandedState();return}if(d._isKeyCombination(t,s.SPACE)&&F(t.target)){t.preventDefault();return}if(this._getKeyboardExtension().isInActionMode()||!o.isOfType(l.ANY)){return}if(d._isKeyCombination(t,s.SPACE)){t.preventDefault()}if(d._isKeyCombination(t,s.SHIFT)&&i===r.MultiToggle&&(o.isOfType(l.ROWHEADER)&&e.isRowSelectorSelectionAllowed(this)||o.isOfType(l.DATACELL|l.ROWACTION))){U(this)}else if(d._isKeyCombination(t,s.A,f.CTRL)){t.preventDefault();if(o.isOfType(l.ANYCONTENTCELL|l.COLUMNROWHEADER)){c.onKeyboardShortcut("toggle",t)}}else if(d._isKeyCombination(t,s.A,f.CTRL+f.SHIFT)){if(o.isOfType(l.ANYCONTENTCELL|l.COLUMNROWHEADER)){t.preventDefault();c.onKeyboardShortcut("clear",t)}}else if(d._isKeyCombination(t,s.F4)){if(o.isOfType(l.DATACELL)){n.setActionMode(true)}}};d.prototype.onkeypress=function(t){if(t.isMarked()){return}const n=this._getKeyboardExtension();const o=e.getCellInfo(t.target);if(d._isKeyCombination(t,"+")){if(d._allowsToggleExpandedState(this,t.target)){N(this,t.target).expand()}else if(o.isOfType(l.DATACELL|l.ROWACTION)){n.setActionMode(true)}}else if(d._isKeyCombination(t,"-")){if(d._allowsToggleExpandedState(this,t.target)){N(this,t.target).collapse()}else if(o.isOfType(l.DATACELL|l.ROWACTION)){n.setActionMode(true)}}};d.prototype.oncontextmenu=function(t){if(t.isMarked("sapUiTableHandledByPointerExtension")){return}const n=e.getCellInfo(document.activeElement);if(n.isOfType(l.ANY)){e.Menu.openContextMenu(this,t)}};d.prototype.onkeyup=function(t){if(t.isMarked()){return}const n=e.getCellInfo(t.target);if(d._isKeyCombination(t,s.SHIFT)){delete this._oRangeSelection}if(n.isOfType(l.COLUMNHEADER)){if(d._isKeyCombination(t,s.SPACE)||d._isKeyCombination(t,s.ENTER)){e.Menu.openContextMenu(this,t)}}else if(d._isKeyCombination(t,s.SPACE)){D(this,t)}else if(d._isKeyCombination(t,s.SPACE,f.SHIFT)){e.toggleRowSelection(this,n.rowIndex);U(this)}else if(this._legacyMultiSelection&&!n.isOfType(l.COLUMNROWHEADER)&&(d._isKeyCombination(t,s.SPACE,f.CTRL)||d._isKeyCombination(t,s.ENTER,f.CTRL))){D(this,t)}};d.prototype.onsaptabnext=function(t){const n=this._getKeyboardExtension();let o=e.getCellInfo(t.target);let i;if(n.isInActionMode()){let s;i=e.getCell(this,t.target);o=e.getCellInfo(i);if(!o.isOfType(l.ANYCONTENTCELL)){return}let r=this.getRows()[o.rowIndex];const f=d._getLastInteractiveElement(r);const c=f===null||f[0]===t.target;if(c){const f=r.getIndex();const c=e.isLastScrollableRow(this,i);const a=this._getTotalRowCount()-1===f;const u=e.isRowSelectorSelectionAllowed(this);t.preventDefault();if(a){n.setActionMode(false)}else if(c){x(this,t)}else{let e=o.rowIndex;if(u){v(this,l.ROWHEADER,e+1)}else{const n=this.getRows().length;let i=false;for(let t=o.rowIndex+1;t<n;t++){e=t;r=this.getRows()[e];s=d._getFirstInteractiveElement(r);i=r.isGroupHeader();if(s||i){break}}if(s){d._focusElement(this,s[0])}else if(i){v(this,l.ROWHEADER,e)}else{x(this,t)}}}}else if(o.isOfType(l.ROWHEADER)){t.preventDefault();s=d._getFirstInteractiveElement(r);d._focusElement(this,s[0])}else{t.preventDefault();s=d._getNextInteractiveElement(this,t.target);d._focusElement(this,s[0])}}else if(o.isOfType(l.ANYCOLUMNHEADER)){if(this.getCreationRow()&&this.getCreationRow().getVisible()&&!e.hasData(this)){S(this,"sapUiTableCtrlAfter")}else if(e.isNoDataVisible(this)){this.$("noDataCnt").trigger("focus");t.preventDefault()}else if(this.getRows().length>0){w(this,t);t.preventDefault()}}else if(o.isOfType(l.ANYCONTENTCELL)){S(this,"sapUiTableCtrlAfter")}else if(t.target===this.getDomRef("overlay")){n.setSilentFocus(this.$().find(".sapUiTableOuterAfter"))}else if(!o.isOfType(l.ANY)){i=e.getParentCell(this,t.target);if(i){t.preventDefault();i.trigger("focus")}}};d.prototype.onsaptabprevious=function(t){const n=this._getKeyboardExtension();let o=e.getCellInfo(t.target);let i;if(n.isInActionMode()){let s;i=e.getCell(this,t.target);o=e.getCellInfo(i);if(!o.isOfType(l.ANYCONTENTCELL)){return}let r=this.getRows()[o.rowIndex];const f=r.getIndex();const c=d._getFirstInteractiveElement(r);const a=c!==null&&c[0]===t.target;const u=e.isRowSelectorSelectionAllowed(this);const g=u||r.isGroupHeader();if(a&&g){t.preventDefault();v(this,l.ROWHEADER,o.rowIndex)}else if(a&&!g||o.isOfType(l.ROWHEADER)||c===null){const c=e.isFirstScrollableRow(this,i);const a=f===0;t.preventDefault();if(a){n.setActionMode(false)}else if(c){_(this,t)}else{let e=o.rowIndex;let n=false;for(let t=o.rowIndex-1;t>=0;t--){e=t;r=this.getRows()[e];s=d._getLastInteractiveElement(r);n=r.isGroupHeader();if(s||g||n){break}}if(s){d._focusElement(this,s[0])}else if(n||g){v(this,l.ROWHEADER,e)}else{_(this,t)}}}else{t.preventDefault();s=d._getPreviousInteractiveElement(this,t.target);d._focusElement(this,s[0])}}else if(o.isOfType(l.ANYCONTENTCELL)||t.target===this.getDomRef("noDataCnt")){if(this.getColumnHeaderVisible()&&(e.getVisibleColumnCount(this)||this.getSelectionMode()!==r.None)){L(this,t);t.preventDefault()}else{S(this,"sapUiTableCtrlBefore")}}else if(t.target===this.getDomRef("overlay")){this._getKeyboardExtension().setSilentFocus(this.$().find(".sapUiTableOuterBefore"))}else if(!o.isOfType(l.ANY)){i=e.getParentCell(this,t.target);if(i){t.preventDefault();i.trigger("focus")}}};d.prototype.onsapdown=function(e){g(e);h(this,e)};d.prototype.onsapdownmodifiers=function(t){if(t.isMarked()||d._isKeyCombination(t,null,f.CTRL+f.ALT)){u(t);return}g(t);if(d._isKeyCombination(t,null,f.CTRL)){h(this,t);return}const n=this._getKeyboardExtension();if(d._isKeyCombination(t,null,f.ALT)&&d._allowsToggleExpandedState(this,t.target)){u(t);N(this,t.target).expand();return}if(n.isInActionMode()){return}const o=e.getCellInfo(t.target);if(d._isKeyCombination(t,null,f.SHIFT)){if(o.isOfType(l.ANYCONTENTCELL)){if(!this._oRangeSelection){u(t);return}const n=e.getRowIndexOfFocusedCell(this);const o=this.getRows()[n].getIndex();const i=this._oRangeSelection.startIndex>o;let s;if(o===this._getTotalRowCount()-1){return}if(e.isLastScrollableRow(this,t.target)){if(this._oRangeSelection.pScroll){u(t);return}else{s=R(this,t);this._oRangeSelection.pScroll=s}}if(s){u(t);s.then(function(){return T(this)}.bind(this)).then(function(){H(this,n-(i?1:0),i);delete this._oRangeSelection.pScroll}.bind(this))}else{H(this,n+(i?0:1),i)}}else{u(t)}}if(d._isKeyCombination(t,null,f.ALT)){if(o.isOfType(l.DATACELL)){n.setActionMode(true)}u(t)}};d.prototype.onsapup=function(e){g(e);m(this,e)};d.prototype.onsapupmodifiers=function(t){if(t.isMarked()||d._isKeyCombination(t,null,f.CTRL+f.ALT)){u(t);return}g(t);if(d._isKeyCombination(t,null,f.CTRL)){m(this,t);return}if(d._isKeyCombination(t,null,f.ALT)&&d._allowsToggleExpandedState(this,t.target)){u(t);N(this,t.target).collapse();return}const n=this._getKeyboardExtension();if(n.isInActionMode()){return}const o=e.getCellInfo(t.target);if(d._isKeyCombination(t,null,f.SHIFT)){if(o.isOfType(l.ANYCONTENTCELL)){if(!this._oRangeSelection){u(t);return}const n=e.getRowIndexOfFocusedCell(this);const o=this.getRows()[n].getIndex();const i=this._oRangeSelection.startIndex<o;let s;if(o===0){u(t);return}if(e.isFirstScrollableRow(this,t.target)){if(this._oRangeSelection.pScroll){u(t);return}else{s=y(this,t);this._oRangeSelection.pScroll=s}}if(s){u(t);s.then(function(){return T(this)}.bind(this)).then(function(){H(this,i?1:0,i);delete this._oRangeSelection.pScroll}.bind(this))}else{H(this,n-(i?0:1),i)}}else{u(t)}}if(d._isKeyCombination(t,null,f.ALT)){if(o.isOfType(l.DATACELL)){n.setActionMode(true)}u(t)}};d.prototype.onsapleft=function(e){g(e)};d.prototype.onsapleftmodifiers=function(t){if(t.isMarked()){u(t);return}g(t);if(this._getKeyboardExtension().isInActionMode()){return}const o=e.getCellInfo(t.target);const i=n.getRTL();if(d._isKeyCombination(t,null,f.SHIFT)){if(o.isOfType(l.DATACELL)){if(!this._oRangeSelection){u(t);return}const n=e.getFocusedItemInfo(this);const o=e.hasRowHeader(this)&&n.cellInRow===1;if(o&&!e.isRowSelectorSelectionAllowed(this)){u(t)}}else if(o.isOfType(l.ROWACTION)){if(!this._oRangeSelection){u(t)}}else if(o.isOfType(l.ROWHEADER)&&i){if(!e.isRowSelectionAllowed(this)){u(t)}}else if(o.isOfType(l.COLUMNROWHEADER)&&i){u(t)}else if(o.isOfType(l.COLUMNHEADER)){let n=-e.convertCSSSizeToPixel(a);let s=0;if(i){n=n*-1}for(let t=o.columnIndex;t<o.columnIndex+o.columnSpan;t++){s+=e.Column.getColumnWidth(this,t)}const l=this.getColumns()[o.columnIndex];e.Column.resizeColumn(this,l,s+n,true,o.columnSpan);u(t)}}else if(d._isKeyCombination(t,null,f.CTRL)){if(o.isOfType(l.COLUMNHEADER)){u(t);M(this.getColumns()[o.columnIndex],i)}}else if(d._isKeyCombination(t,null,f.ALT)){u(t)}};d.prototype.onsaprightmodifiers=function(t){if(t.isMarked()){u(t);return}g(t);if(this._getKeyboardExtension().isInActionMode()){return}const o=e.getCellInfo(t.target);const i=n.getRTL();if(d._isKeyCombination(t,null,f.SHIFT)){if(o.isOfType(l.DATACELL)){if(!this._oRangeSelection){u(t)}}else if(o.isOfType(l.ROWHEADER)){if(!e.isRowSelectionAllowed(this)){u(t)}}else if(o.isOfType(l.ROWACTION)&&i){if(!this._oRangeSelection){u(t)}}else if(o.isOfType(l.COLUMNHEADER)){let n=e.convertCSSSizeToPixel(a);let s=0;if(i){n=n*-1}for(let t=o.columnIndex;t<o.columnIndex+o.columnSpan;t++){s+=e.Column.getColumnWidth(this,t)}const l=this.getColumns()[o.columnIndex];e.Column.resizeColumn(this,l,s+n,true,o.columnSpan);u(t)}else if(o.isOfType(l.COLUMNROWHEADER)){u(t)}}else if(d._isKeyCombination(t,null,f.CTRL)){if(o.isOfType(l.COLUMNHEADER)){u(t);M(this.getColumns()[o.columnIndex],!i)}}else if(d._isKeyCombination(t,null,f.ALT)){u(t)}};d.prototype.onsaphome=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(e.Grouping.isInGroupHeaderRow(t.target)){u(t);return}const n=e.getCellInfo(t.target);if(n.isOfType(l.DATACELL|l.ROWACTION|l.COLUMNHEADER|l.ROWACTIONCOLUMNHEADER)){const n=e.getFocusedItemInfo(this);const o=n.cell;const i=n.cellInRow;const s=this.getComputedFixedColumnCount();const l=e.hasRowHeader(this);const r=l?1:0;if(e.hasFixedColumns(this)&&i>s+r){u(t);e.focusItem(this,o-i+s+r,null)}else if(l&&i>1){u(t);e.focusItem(this,o-i+r,null)}}};d.prototype.onsapend=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(e.Grouping.isInGroupHeaderRow(t.target)){u(t);return}const n=e.getCellInfo(t.target);if(n.isOfType(l.ANY)){const o=e.getFocusedItemInfo(this);const i=o.cell;const s=o.columnCount;const r=this.getComputedFixedColumnCount();const f=o.cellInRow;const c=e.hasRowHeader(this);const a=c?1:0;let g=false;if(n.isOfType(l.COLUMNHEADER)&&e.hasFixedColumns(this)){const e=parseInt(n.cell.getAttribute("colspan")||1);if(e>1&&f+e-a===r){g=true}}if(c&&f===0){u(t);e.focusItem(this,i+1,null)}else if(e.hasFixedColumns(this)&&f<r-1+a&&!g){u(t);e.focusItem(this,i+r-f,null)}else if(e.hasRowActions(this)&&f<s-2){u(t);e.focusItem(this,i-f+s-2,null)}}};d.prototype.onsaphomemodifiers=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(d._isKeyCombination(t,null,f.CTRL)){const n=e.getCellInfo(t.target);if(n.isOfType(l.ANYCONTENTCELL|l.COLUMNHEADER)){u(t);const n=e.getFocusedItemInfo(this);const o=n.row;if(o>0){const i=n.cell;const s=n.columnCount;const l=e.getHeaderRowCount(this);const r=this._getRowCounts();if(o<l+r.fixedTop){e.focusItem(this,i-s*o,t)}else if(o>=l+r.fixedTop&&o<l+e.getNonEmptyRowCount(this)-r.fixedBottom){this._getScrollExtension().scrollVerticallyMax(false);if(r.fixedTop>0){e.focusItem(this,i-s*(o-l),t)}else{e.focusItem(this,i-s*o,t)}}else{this._getScrollExtension().scrollVerticallyMax(false);e.focusItem(this,i-s*(o-l-r.fixedTop),t)}}}}};d.prototype.onsapendmodifiers=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(d._isKeyCombination(t,null,f.CTRL)){const n=e.getCellInfo(t.target);if(n.isOfType(l.ANY)){const n=e.getFocusedItemInfo(this);const o=n.row;const i=e.getHeaderRowCount(this);const s=e.getNonEmptyRowCount(this);const l=this._getRowCounts();u(t);if(l.fixedBottom===0||o<i+s-1||e.isNoDataVisible(this)&&o<i-1){const r=n.cell;const f=n.columnCount;if(e.isNoDataVisible(this)){e.focusItem(this,r+f*(i-o-1),t)}else if(o<i){if(l.fixedTop>0){e.focusItem(this,r+f*(i+l.fixedTop-o-1),t)}else{this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,r+f*(i+s-l.fixedBottom-o-1),t)}}else if(o>=i&&o<i+l.fixedTop){this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,r+f*(i+s-l.fixedBottom-o-1),t)}else if(o>=i+l.fixedTop&&o<i+s-l.fixedBottom){this._getScrollExtension().scrollVerticallyMax(true);e.focusItem(this,r+f*(i+s-o-1),t)}else{e.focusItem(this,r+f*(i+s-o-1),t)}}}}};d.prototype.onsappageup=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}const n=e.getCellInfo(t.target);if(n.isOfType(l.ANYCONTENTCELL|l.COLUMNHEADER)){const o=e.getFocusedItemInfo(this);const i=o.row;const s=e.getHeaderRowCount(this);const r=this._getRowCounts();if(r.fixedTop===0&&i>=s||r.fixedTop>0&&i>s){u(t);const f=o.cell;const c=o.columnCount;if(i<s+r.fixedTop){e.focusItem(this,f-c*(i-s),t)}else if(i===s+r.fixedTop){const o=e.getNonEmptyRowCount(this)-r.fixedTop-r.fixedBottom;const a=this.getFirstVisibleRow();y(this,t,true);if(a<o){if(r.fixedTop>0||n.isOfType(l.ROWACTION)){e.focusItem(this,f-c*(i-s),t)}else{e.focusItem(this,f-c*s,t)}}}else if(i>s+r.fixedTop&&i<s+e.getNonEmptyRowCount(this)){e.focusItem(this,f-c*(i-s-r.fixedTop),t)}else{e.focusItem(this,f-c*(i-s-e.getNonEmptyRowCount(this)+1),t)}}if(n.isOfType(l.ROWACTION)&&i===s&&r.fixedTop>0){u(t)}}};d.prototype.onsappagedown=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}const n=e.getCellInfo(t.target);if(n.isOfType(l.ANY)){const o=e.getFocusedItemInfo(this);const i=o.row;const s=e.getHeaderRowCount(this);const r=e.getNonEmptyRowCount(this);const f=this._getRowCounts();u(t);if(e.isNoDataVisible(this)&&i<s-1||f.fixedBottom===0||i<s+r-1){const c=o.cell;const a=o.columnCount;if(i<s-1&&!n.isOfType(l.COLUMNROWHEADER)){e.focusItem(this,c+a*(s-i-1),t)}else if(i<s){if(!e.isNoDataVisible(this)){e.focusItem(this,c+a*(s-i),t)}}else if(i>=s&&i<s+r-f.fixedBottom-1){e.focusItem(this,c+a*(s+r-f.fixedBottom-i-1),t)}else if(i===s+r-f.fixedBottom-1){const n=e.getNonEmptyRowCount(this)-f.fixedTop-f.fixedBottom;const o=this._getTotalRowCount()-f.fixedBottom-this.getFirstVisibleRow()-n*2;R(this,t,true);if(o<n&&f.fixedBottom>0){e.focusItem(this,c+a*(s+r-i-1),t)}}else{e.focusItem(this,c+a*(s+r-i-1),t)}}}};d.prototype.onsappageupmodifiers=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(d._isKeyCombination(t,null,f.ALT)){const n=e.getCellInfo(t.target);const o=e.getFocusedItemInfo(this);if(n.isOfType(l.DATACELL|l.COLUMNHEADER)){const n=o.cell;const i=o.cellInRow;const s=e.hasRowHeader(this);const l=s?1:0;const r=c;u(t);if(s&&(e.Grouping.isInGroupHeaderRow(t.target)||i===1)){e.focusItem(this,n-i,null)}else if(i-l<r){e.focusItem(this,n-i+l,null)}else{e.focusItem(this,n-r,null)}}else if(n.isOfType(l.ROWACTION)){e.focusItem(this,o.cell-1,null)}}};d.prototype.onsappagedownmodifiers=function(t){g(t);if(this._getKeyboardExtension().isInActionMode()){return}if(d._isKeyCombination(t,null,f.ALT)){const n=e.getCellInfo(t.target);if(n.isOfType(l.DATACELL|l.ROWHEADER|l.ANYCOLUMNHEADER)){const o=e.getFocusedItemInfo(this);const i=o.cellInRow;const s=e.hasRowHeader(this);const r=s?1:0;const f=e.getVisibleColumnCount(this);const a=parseInt(n.cell.getAttribute("colspan")||1);u(t);if(i+a-r<f){const n=o.cell;const l=c;if(s&&i===0){e.focusItem(this,n+1,null)}else if(a>l){e.focusItem(this,n+a,null)}else if(i+a-r+l>f){e.focusItem(this,n+f-i-1+r,null)}else if(!e.Grouping.isInGroupHeaderRow(t.target)){e.focusItem(this,n+l,null)}}else if(n.isOfType(l.DATACELL)&&e.hasRowActions(this)&&i===o.columnCount-2){e.focusItem(this,o.cell+1,null)}}}};d.prototype.onsapenter=function(e){D(this,e)};return d});
//# sourceMappingURL=KeyboardDelegate.js.map