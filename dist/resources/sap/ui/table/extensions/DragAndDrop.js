/*!
 * OpenUI5
 * (c) Copyright 2009-2025 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExtensionBase","../utils/TableUtils","sap/ui/core/library"],function(t,e,o){"use strict";const n="sap.ui.table";const s=o.dnd.DropPosition;const i={getSessionData:function(t,e){return t.getComplexData(n+(e==null?"":"-"+e))},setSessionData:function(t,e,o){t.setComplexData(n+(o==null?"":"-"+o),e)},getInstanceSessionData:function(t,e){return this.getSessionData(t,e.getId())},setInstanceSessionData:function(t,e,o){this.setSessionData(t,o,e.getId())},scrollVertically:e.throttle(function(t,e,o,n){const s=t._getScrollExtension().getVerticalScrollbar();s.scrollTop+=this.calculateScrollDistance(o,n)*(e?1:-1)},50),scrollHorizontally:e.throttle(function(t,e,o,n){const s=t._getScrollExtension().getHorizontalScrollbar();s.scrollLeft+=this.calculateScrollDistance(o,n)*(e?1:-1)},50),calculateScrollDistance:function(t,e){const o=2;const n=50;const s=e/t;return Math.max(o,Math.round(n*s))}};const l={ondragstart:function(t){const e=t.dragSession;if(!e||!e.getDragControl()){return}const o=e.getDragControl();const n={};if(o.isA("sap.ui.table.Row")){if(o.isEmpty()||o.isGroupHeader()||o.isSummary()){t.preventDefault();return}else{n.draggedRowContext=o.getRowBindingContext()}}i.setInstanceSessionData(e,this,n)},ondragenter:function(t){const o=t.dragSession;if(!o||!o.getDropControl()){return}let n=i.getInstanceSessionData(o,this);const l=o.getDragControl();const r=o.getDropControl();if(!n){n={}}if(r.isA("sap.ui.table.Row")){const i=n.draggedRowContext;const l=r.getRowBindingContext();const a=o.getDropInfo().getDropPosition();if(r.isEmpty()&&a===s.On&&e.hasData(this)||i&&i===l||r.isGroupHeader()||r.isSummary()){t.setMarked("NonDroppable")}else{if(!l){const t=this.getRows()[e.getNonEmptyRowCount(this)-1];o.setDropControl(t||this)}if(o.getDropControl()!==this){const t=this.getDomRef().classList.contains("sapUiTableVScr");const e=this.getDomRef("sapUiTableCnt").getBoundingClientRect();o.setIndicatorConfig({width:e.width-(t?16:0),left:e.left+(this._bRtlMode&&t?16:0)})}}}else if(r.isA("sap.ui.table.Column")){const n=e.getCellInfo(e.getCell(this,t.target)).columnIndex;if(l.isA("sap.ui.table.Column")&&!e.Column.isColumnMovableTo(l,n,true)){t.setMarked("NonDroppable");return}const s=this.getDomRef("sapUiTableCnt").getBoundingClientRect();o.setIndicatorConfig({height:s.height-(this._getScrollExtension().isHorizontalScrollbarVisible()?16:0)})}else if(l===r){t.setMarked("NonDroppable")}if(!n.verticalScrollEdge){const t=window.pageYOffset;const e=this.getDomRef("table").getBoundingClientRect();n.verticalScrollEdge={bottom:e.bottom+t,top:e.top+t}}const a=window.pageXOffset;const c=this.getDomRef("sapUiTableCtrlScr").getBoundingClientRect();n.horizontalScrollEdge={left:c.left+a,right:c.right+a};i.setInstanceSessionData(o,this,n)},ondragover:function(t){const e=t.dragSession;if(!e){return}const o=i.getInstanceSessionData(e,this);if(!o){return}const n=50;const s=e.getDropControl();const l=this._getScrollExtension();const r=l.getVerticalScrollbar();const a=l.getHorizontalScrollbar();const c=o.verticalScrollEdge;const g=o.horizontalScrollEdge;if(c&&r&&s!==this){const e=t.pageY;if(e>=c.top-n&&e<=c.top+n){i.scrollVertically(this,false,n*2,c.top+n-e)}else if(e<=c.bottom+n&&e>=c.bottom-n){i.scrollVertically(this,true,n*2,e-c.bottom+n)}}if(g&&a&&s!==this){const e=t.pageX;if(e>=g.left-n&&e<=g.left+n){i.scrollHorizontally(this,false,n*2,g.left+n-e)}else if(e<=g.right+n&&e>=g.right-n){i.scrollHorizontally(this,true,n*2,e-g.right+n)}}},onlongdragover:function(t){const o=t.dragSession;if(!o){return}const n=e.getCell(this,t.target);const s=e.getCellInfo(n).rowIndex;const i=s==null?null:this.getRows()[s];const l=o.getDropControl();if(i&&(l===i||!l)){i.expand()}},ondragend:function(t){i.scrollVertically.cancel();i.scrollHorizontally.cancel()}};const r=t.extend("sap.ui.table.extensions.DragAndDrop",{_init:function(t,o,n){this._oDelegate=l;e.addDelegate(t,this._oDelegate,t);return"DragAndDropExtension"},_debug:function(){this._ExtensionDelegate=l},destroy:function(){const e=this.getTable();if(e){e.removeEventDelegate(this._oDelegate)}i.scrollVertically.cancel();i.scrollHorizontally.cancel();this._oDelegate=null;t.prototype.destroy.apply(this,arguments)}});return r});
//# sourceMappingURL=DragAndDrop.js.map